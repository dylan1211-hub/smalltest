<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>GeoAR.js demo</title>
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.10.2/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.10.2/addons/p5.sound.min.js"></script>
    <script>
      THREEx.ArToolkitContext.baseURL =
        "https://raw.githack.com/jeromeetienne/ar.js/master/three.js/";
    </script>
    <script
      src="https://kit.fontawesome.com/9a416a1cca.js"
      crossorigin="anonymous"
    ></script>
</head>

<link rel="stylesheet" href="./index.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />


<body style='margin: 0; overflow: hidden;'>

    <div class="panel" style="display:none" id="mySidebar" position="relative" z-index="2">
        <button onclick="w3_close()" class="close">X</button>

        <h2 style="color: rgb(113, 113, 113);" class="let_space">èµ·é»</h2>
        <span class="info1">     æ™´â˜€ï¸    </span><br><br>
        <span class="info1">æº«åº¦:33â„ƒ æ¿•åº¦: 10%  </span><br><br>
        <span class="info1">é™é›¨æ©Ÿç‡ : 10%</span><br><br>
        <span class="info1"> AQI : 19 âœ… </span>
        <h2 style="color: rgb(113, 113, 113);" class="let_space">çµ‚é»</h2>
            <span class="info3">  æ™´æ™‚å¤šé›²ğŸŒ¥ï¸ </span><br><br>
            <span class="info3">æº«åº¦:31â„ƒ æ¿•åº¦: 20%  </span><br><br>
            <span class="info3">é™é›¨æ©Ÿç‡ : 30%</span><br><br>
            <span class="info3"> AQI : 10 âœ… </span><br><br><br>
            <center><button onclick="open_sidebar2()" class="os2b" >é¡¯ç¤ºå‘¨é‚Šä¼‘æ¯æ“šé»</button></center>
    </div>

    <div class="panel2" style="display:none" id="mySidebar2" position="relative" z-index="2">
        <button onclick="open_sidebar()" class="back">â†©</button>
        <h2 style="color: rgb(113, 113, 113);" class="let_space">à¼¼ ã¤â—•_â—• à¼½ã¤ä¾¿åˆ©è¶…å•†</h2>
            <p>
               <label for="7-11"> <input type="checkbox" name="7-11" value="7-11" id="7-11"  /><span class="info5">7-11</span></label>
            </p>
            <p>
               <label for="å…¨å®¶"><input type="checkbox" name="å…¨å®¶" value="å…¨å®¶" id="å…¨å®¶"  /><span class="info5">å…¨å®¶</span></label>
            </p>
            <p>
               <label for="èŠçˆ¾å¯Œ"><input type="checkbox" name="èŠçˆ¾å¯Œ" value="èŠçˆ¾å¯Œ" id="èŠçˆ¾å¯Œ" /><span class="info5">èŠçˆ¾å¯Œ</span></label>
            </p>
            <p>
                <label for="OK"><input type="checkbox" name="OK" value="OK" id="OK" /><span class="info5">OK</span></label>
            </p>
            <p>
                <label for="å…¨è¯"><input type="checkbox" name="å…¨è¯" value="å…¨è¯" id="å…¨è¯" /><span class="info5">å…¨è¯</span></label>
            </p>
        <h2 style="color: rgb(113, 113, 113);" class="let_space">à¼¼ ã¤ â—•_â—• à¼½ã¤ç¾é£Ÿé¤é£²</h2>
            <p>
               <label for="ç¾é£Ÿå°åƒ"> <input type="checkbox" name="ç¾é£Ÿå°åƒ" value="ç¾é£Ÿå°åƒ" id="ç¾é£Ÿå°åƒ" /><span class="info4">ç¾é£Ÿå°åƒ</span></label>
            </p>
            <p>
               <label for="è›‹ç³•ç”œé»"><input type="checkbox" name="è›‹ç³•ç”œé»" value="è›‹ç³•ç”œé»" id="è›‹ç³•ç”œé»" /><span class="info4">è›‹ç³•ç”œé»</span></label>
            </p>
            <p>
               <label for="é£²æ–™å†°å“"><input type="checkbox" name="é£²æ–™å†°å“" value="é£²æ–™å†°å“" id="é£²æ–™å†°å“" /><span class="info4">é£²æ–™å†°å“</span></label>
            </p>
            <p>
                <label for="å’–å•¡å»³"><input type="checkbox" name="å’–å•¡å»³" value="å’–å•¡å»³" id="å’–å•¡å»³" /><span class="info4">å’–å•¡å»³</span></label>
            </p>
            <p>
                <label for="ä¼´æ‰‹ç¦®"><input type="checkbox" name="ä¼´æ‰‹ç¦®" value="ä¼´æ‰‹ç¦®" id="ä¼´æ‰‹ç¦®" /><span class="info4">ä¼´æ‰‹ç¦®</span></label>
            </p>
        
    </div>

    <div class="open">
        <button class="opb" onclick="w3_open()"position="relative" z-index="1">â˜°</button>
      </div>
      
      <span id = "d" style="width:180px ; height:40px ; position:fixed; left: 1px; bottom: 43px;display: block;
      background-color: rgba(61, 223, 255, 0.674);color: #ffffff; border-radius: 10px; font-size: 26px;text-align: center; " ></span>
      <span id = "t" style="width:180px ; height:40px ; position:fixed; left: 1px; bottom: 2px;display: block;
      background-color: rgba(61, 177, 255, 0.674);color: #ffffff; border-radius: 10px; font-size: 26px;text-align: center; " ></span>

        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDP_8BwsuhrCaT7AovatGprt01OE6cke4E"></script>
        <script>
        window.onload = () => {
                const _this=this;
        if(navigator.geolocation) {
        // ä½¿ç”¨è€…ä¸æä¾›æ¬Šé™ï¼Œæˆ–æ˜¯ç™¼ç”Ÿå…¶å®ƒéŒ¯èª¤
        function error() {
        alert('ç„¡æ³•å–å¾—ä½ çš„ä½ç½®');
        }       
        // ä½¿ç”¨è€…å…è¨±æŠ“ç›®å‰ä½ç½®ï¼Œå›å‚³ç¶“ç·¯åº¦
        function success(position) {
        // å°‡æ‰€åœ¨åœ°è¨­æˆæ¯”è¼ƒçš„é»
        let originPosition = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
        console.log(position.coords.latitude, position.coords.longitude);
        // è¨­å®šç›®çš„åœ°çš„é»
        let destination = new google.maps.LatLng(22.990544235195003, 120.22093319574124);
        // æ‰€åœ¨ä½ç½®è·Ÿå„é»çš„è·é›¢
        const service = new google.maps.DistanceMatrixService();
                service.getDistanceMatrix({
                origins: [originPosition],
                destinations: [destination],
                travelMode: 'WALKING', // äº¤é€šæ–¹å¼ï¼šBICYCLING(è‡ªè¡Œè»Š)ã€DRIVING(é–‹è»Šï¼Œé è¨­)ã€TRANSIT(å¤§çœ¾é‹è¼¸)ã€WALKING(èµ°è·¯)
                unitSystem: google.maps.UnitSystem.METRIC , // å–®ä½ METRIC(å…¬é‡Œï¼Œé è¨­)ã€IMPERIAL(å“©)
                avoidHighways: true, // æ˜¯å¦é¿é–‹é«˜é€Ÿå…¬è·¯
                avoidTolls: true // æ˜¯å¦é¿é–‹æ”¶è²»è·¯ç·š
                }, callback);
                function callback(response, status) {
                console.log(response);
                var d = response.rows[0].elements[0].distance.text;
                var t = response.rows[0].elements[0].duration.text;
                console.log(d);
                console.log(t);
                document.getElementById('d').innerHTML="è·é›¢:"+d;
                document.getElementById('t').innerHTML="æ™‚é–“:"+t;
                
                }

        }
        // è·Ÿä½¿ç”¨è€…æ‹¿æ‰€åœ¨ä½ç½®çš„æ¬Šé™
        navigator.geolocation.getCurrentPosition(success, error);
        } else {
        alert('Sorry, ä½ çš„è£ç½®ä¸æ”¯æ´åœ°ç†ä½ç½®åŠŸèƒ½ã€‚')
        }
        }
        </script>

    <a-scene
        cursor='rayOrigin: mouse; fuse: true; fuseTimeout: 0;'
        raycaster="objects: [gps-entity-place];useWorldCoordinates:true"
        vr-mode-ui='enabled: false' 
            arjs='sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; debugUIEnabled: false;'>

        <a-entity gltf-model="https://dylan1211-hub.github.io/smalltest/bus_test/assets/arrow1/scene.gltf" rotation="0 0 0" scale="0.08 0.08 0.08" 
            position="1 1.2 1" animation-mixer >
        </a-entity>

        <img id="compass" src="https://dylan1211-hub.github.io/smalltest/bus_test/assets/arrow1.png" rotation="30 0 0" scale="0.01 0.01 0.01"
        style="width:150px ; height:40px ; position:fixed; left: 25px; top: 525px;display: block;"/>
        <script src="https://unpkg.com/@joeyklee/compass.js@latest/dist/compass.js"></script>
        <script>
        let compass;
        window.addEventListener('DOMContentLoaded', async() =>{
        alert("a compass that always points you to Bus Stop")
        const $compass = document.querySelector("#compass");

        compass = new Compass();
        await compass.init();
        
        setInterval( () => {
        const currentPosition = {lat: compass.position.coords.latitude, lng: compass.position.coords.longitude};
        const angleToStop = compass.getBearingToDestination(currentPosition, {lat:22.990544235195003, lng:120.22093319574124});
        $compass.style.transform = `rotate(${Math.round(angleToStop)}deg)`;
        }, 100);

        })
        </script>

        <a-entity gltf-model="https://dylan1211-hub.github.io/smalltest/bus_test/assets/billboard/scene.gltf" rotation="0 -30 0" scale="3 2 2" 
            gps-entity-place="longitude:120.22093319574124; latitude:22.990544235195003 " animation-mixer >

        <a-text value="Private Chang Jung" color="#70C1CF" zOffset="9999" anchor="left" 
                baseline="top" scale="0.3 0.3 0.3" position="-0.35 0.83 1">
        </a-text>
        <a-text value="Girls' Senior High School" color="#70C1CF" zOffset="9999" anchor="left" 
                baseline="top" scale="0.3 0.3 0.3" position="-0.35 0.77 1">
        </a-text>
        <a-text value="- - - - - - - - - - - - - - - - - - - - " color="gray" zOffset="9999" anchor="left" 
                baseline="top" scale="0.3 0.3 0.3" position="-0.35 0.72 1">
        </a-text>
        <a-text value="Route Name" color="gray" zOffset="9999" anchor="left" 
                baseline="top" scale="0.3 0.3 0.3" position="-0.35 0.67 1">
        </a-text>
        <a-text value="70" color="#E6C35C" zOffset="9999" anchor="left" 
                baseline="top" scale="0.4 0.4 0.4" position="0.16 0.68 1">
        </a-text>
        <a-text value="Now at" color="gray" zOffset="9999" anchor="left" 
                baseline="top" scale="0.3 0.3 0.3" position="-0.35 0.60 1">
        </a-text>
        <a-text value="Dadong Night Market -> " color="#528B40" zOffset="9999" anchor="left" 
                baseline="top" scale="0.3 0.3 0.3" position="-0.37 0.53 1">
        </a-text>
        <a-text value="Shengli School" color="#528B40" zOffset="9999" anchor="left" 
                baseline="top" scale="0.3 0.3 0.3" position="-0.37 0.44 1">
        </a-text>
        <a-text value="Estimate Time" color="gray" zOffset="9999" anchor="left" 
                baseline="top" scale="0.3 0.3 0.3" position="-0.35 0.36 1">
        </a-text>
        <a-text value="5" color="#CD5C5C" zOffset="9999" anchor="left" 
                baseline="top" scale="0.4 0.4 0.4" position="0.14 0.37 1">
        </a-text>
        <a-text value="min" color="gray" zOffset="9999" anchor="left" 
                baseline="top" scale="0.3 0.3 0.3" position="0.22 0.36 1">
        </a-text>
        <a-text value="---------------------------------------" color="gray" zOffset="9999" anchor="left" 
                baseline="top" scale="0.3 0.3 0.3" position="-0.37 0.31 1">
        </a-text>
        <a-text value="Route Name" color="gray" zOffset="9999" anchor="left" 
                baseline="top" scale="0.3 0.3 0.3" position="-0.35 0.26 1">
        </a-text>
        <a-text value="0" color="#E6C35C" zOffset="9999" anchor="left" 
                baseline="top" scale="0.4 0.4 0.4" position="0.16 0.27 1">
        </a-text>
        <a-text value="Now at" color="gray" zOffset="9999" anchor="left" 
                baseline="top" scale="0.3 0.3 0.3" position="-0.35 0.20 1">
        </a-text>
        <a-text value="Carrefour ->" color="#528B40" zOffset="9999" anchor="left" 
                baseline="top" scale="0.3 0.3 0.3" position="-0.35 0.13 1">
        </a-text>
        <a-text value="wennan rd. intersection" color="#528B40" zOffset="9999" anchor="left" 
            baseline="top" scale="0.3 0.3 0.3" position="-0.35 0.06 1">
    </a-text>
        <a-text value="Estimate Time" color="gray" zOffset="9999" anchor="left" 
                baseline="top" scale="0.3 0.3 0.3" position="-0.35 -0.01 1">
        </a-text>
        <a-text value="6" color="#CD5C5C" zOffset="9999" anchor="left" 
                baseline="top" scale="0.4 0.4 0.4" position="0.09 0 1">
        </a-text>
        <a-text value="min" color="gray" zOffset="9999" anchor="left" 
                baseline="top" scale="0.3 0.3 0.3" position="0.22 -0.01 1">
        </a-text>


        </a-entity>
        

        <a-camera gps-camera rotation-reader>
            <!---<input type="checkbox"  id="side-menu-switch">
            <div class="side-menu">
                <label for="side-menu-switch">
                    <i class="fas fa-angle-left"></i>
                </label>
            </div>-->
            
        </a-camera>

	</a-scene>

    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>

    function w3_open() {
    document.getElementById("mySidebar").style.display = "block";
    }

    function w3_close() {
    document.getElementById("mySidebar").style.display = "none";
    }

    function open_sidebar2(){
    document.getElementById("mySidebar").style.display = "none";
    document.getElementById("mySidebar2").style.display = "block";
    }

    function open_sidebar(){
    document.getElementById("mySidebar").style.display = "block";
    document.getElementById("mySidebar2").style.display = "none";    
    }

        /*
        //ä»‹æ¥çš„part

        var places=[];
        renderPlaces(places);


        //æ¸²æŸ“çš„part
        function renderPlaces(places) {
          let scene = document.querySelector('a-scene');
          const latitude = places[0].latitude;  
          const longitude = places[0].longitude; 

          const billboard = document.createElement('a-entity');
          billboard.setAttribute('gps-entity-place', `latitude: ${latitude}; longitude: ${longitude}`);
          billboard.setAttribute('url','https://dylan1211-hub.github.io/smalltest/bus_test/assets/billboard/scene.gltf');
          billboard.setAttribute('rotation','0 ,0 ,0');
          billboard.setAttribute('scale','10,10,10');
          billboard.setAttribute('animation-mixer','')

          billboard.addEventListener('loaded', () => window.dispatchEvent(new CustomEvent('gps-entity-place-loaded')));

          const title = document.createElement('a-text');
            title.setAttribute('value', /*places[i].name);
            title.setAttribute('scale', '0.3 0.3 0.3');
            title.setAttribute('color','gray');
            title.setAttribute('zOffset','9999');
            title.setAttribute('anchor','left');
            title.setAttribute('baseline','top');
            title.setAttribute('position','-0.3 0.65 1')

            title.addEventListener('loaded', () => window.dispatchEvent(new CustomEvent('gps-entity-place-loaded')));
        
        
            scene.appendChild(billboard);
            billboard.appendChild(title);
        } */

        //OSM leaflet(web map)çš„part
        document.addEventListener('DOMContentLoaded', () => {  

        const zoo = [22.998593072090404, 120.2197879523883]; // é è¨­ä¸­å¿ƒé»ç‚ºå°åŒ—å¸‚å‹•ç‰©åœ’

        // å»ºç«‹åœ°åœ–
        const map = L.map('map', {
        attributionControl: false, // æ˜¯å¦ç§€å‡º leaflet
        zoomControl: false , // æ˜¯å¦ç§€å‡º - + æŒ‰éˆ•
        zoom: 17, // 0-18
        });
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);



        // å»ºç«‹ marker
        const customIcon = L.icon({
        iconUrl: 'https://letswritetw.github.io/letswrite-leaflet-osm-locate/dist/dot.svg',
        iconSize: [16, 16],
        });
        const marker = L.marker(zoo, {
        icon: customIcon,
        title: 'è·Ÿ <a> çš„ title ä¸€æ¨£', // è·Ÿ <a> çš„ title ä¸€æ¨£
        opacity: 1.0
        }).addTo(map);


        // è·Ÿä½¿ç”¨è€…è¦ä½ç½®
        // åƒè€ƒæ–‡ä»¶ï¼šhttps://leafletjs.com/examples/mobile/ã€https://leafletjs.com/reference-1.7.1.html#map-locate
        map.locate({ setView: true, watch: true, maxZoom: 18, enableHighAccuracy: true });

        // ä½¿ç”¨è€…ä¸æä¾›ä½ç½®
        function errorHandler(e) {
        console.log("e", e);
        window.alert('ç„¡æ³•åˆ¤æ–·æ‚¨çš„æ‰€åœ¨ä½ç½®ï¼Œç„¡æ³•ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚é è¨­åœ°é»å°‡ç‚º æ¸¬é‡ç³»é¤¨');
        map.setView(zoo, 18); // ä¸­å¿ƒç§»åˆ°å‹•ç‰©åœ’
        moveTo(map); // ç§»å‹•åˆ°æŒ‡å®šåº§æ¨™ï¼ˆå¹³æ»‘ || ç¸®æ”¾ æ•ˆæœï¼‰
        panBy(map); // ç§»å‹• x, y ä½ç½®
        }
        map.on('locationerror', errorHandler);

        // ä½¿ç”¨è€…æä¾›ä½ç½®
        function foundHandler(e) {
        console.log("e", e);
        marker.setLatLng(e.latlng); // ç§»å‹• marker
        map.setView(e.latlng, 17);
        moveTo(map); // ç§»å‹•åˆ°æŒ‡å®šåº§æ¨™ï¼ˆå¹³æ»‘ || ç¸®æ”¾ æ•ˆæœï¼‰
        panBy(map); // ç§»å‹• x, y ä½ç½®
        }
        map.on('locationfound', foundHandler);


        // ç§»å‹•åˆ°æŒ‡å®šåº§æ¨™ï¼ˆå¹³æ»‘ || ç¸®æ”¾ æ•ˆæœï¼‰
        function moveTo(map) {
        const btnPanto = document.querySelectorAll('.js-panto');
        Array.prototype.forEach.call(btnPanto, pan => {
            pan.addEventListener('click', e => {
            e.preventDefault();
            let latLng = e.target.dataset.to.split(',');
            let name = e.target.textContent;
            let toggleFly = document.getElementById('flyTo').checked;
            const popup = L.popup();
            popup
                .setLatLng(latLng)
                .setContent(`${name}`)
                .openOn(map);
            toggleFly ? map.flyTo(latLng) : map.panTo(latLng);
            })
        })
        }

        // ç§»å‹• x, y ä½ç½®
        function panBy(map) {
        const btnPanby = document.querySelectorAll('.js-panby');
        Array.prototype.forEach.call(btnPanby, pan => {
            pan.addEventListener('click', e => {
            e.preventDefault();
            let times = e.target.dataset.times;
            let point = 50 * times;
            let points = [point, point];
            map.panBy(points);
            })
        })
        }

 var stores = [
    {
      "type": "FeatureCollection",
      "features": [
     {
       "type": "Feature",
       "geometry": {
          "type": "Point",
          "coordinates":  [120.22093319574124,22.990544235195003 ]
       },
       "properties": {
       "type":"3C",
       }
     }
    ]
    }
    ]

        var MyIcon = L.icon({
        iconUrl: './assets/r4.png',
        iconSize:     [10, 10], // size of the icon
        shadowSize:   [50, 64], // size of the shadow
        iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
        shadowAnchor: [4, 62],  // the same for the shadow
        popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
        });

        L.geoJson(stores,{icon: MyIcon}).addTo(map);

        })
    </script>
   

</body>